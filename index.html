<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --pv: #ff4d4d; --pe: #4d94ff; --ia: #9933ff; --gold: #d4af37;
            --panel-bg: #161616;
        }

        body { background: transparent; font-family: 'Inter', sans-serif; color: white; margin: 0; padding: 10px; }

        /* HUD OBS */
        #hud { display: none; filter: drop-shadow(0 0 8px rgba(0,0,0,0.9)); border-left: 4px solid var(--gold); padding-left: 15px; }
        .hud-line { font-family: 'Special Elite', cursive; font-size: 28px; font-weight: bold; margin-bottom: 2px; text-transform: uppercase; }
        .label-pv { color: var(--pv); } .label-pe { color: var(--pe); } .label-ia { color: var(--ia); }

        /* PAINEL DO MESTRE */
        #admin { background: var(--panel-bg); border: 2px solid var(--gold); padding: 25px; width: 850px; display: none; border-radius: 4px; }
        .admin-header { font-family: 'Special Elite', cursive; color: var(--gold); text-align: center; border-bottom: 1px solid var(--gold); margin-bottom: 20px; padding-bottom: 10px; font-size: 24px; }

        .char-grid-header { display: grid; grid-template-columns: 120px 180px 180px 180px 40px; gap: 15px; margin-bottom: 10px; font-weight: bold; color: #888; font-size: 11px; text-transform: uppercase; text-align: center; }
        .char-row { display: grid; grid-template-columns: 120px 180px 180px 180px 40px; gap: 15px; background: rgba(255,255,255,0.03); padding: 10px; margin-bottom: 8px; align-items: center; border-radius: 4px; }
        
        .name-cell { font-family: 'Special Elite', cursive; color: var(--gold); font-size: 18px; }
        .stat-group { display: flex; align-items: center; justify-content: center; gap: 5px; }

        input[type="number"] { background: #222; color: white; border: 1px solid #444; width: 55px; padding: 6px; text-align: center; font-size: 16px; border-radius: 3px; outline: none; }
        .in-pv { border-bottom: 2px solid var(--pv) !important; }
        .in-pe { border-bottom: 2px solid var(--pe) !important; }
        .in-ia { border-bottom: 2px solid var(--ia) !important; }
        
        .max-label { font-size: 14px; color: #aaa; font-weight: bold; width: 55px; text-align: center; }
        .separator { font-weight: bold; color: #555; }
    </style>
</head>
<body>

    <div id="hud">
        <div class="hud-line"><span class="label-pv">PV:</span> <span id="val-hp">0/0</span></div>
        <div class="hud-line"><span class="label-pe">PE:</span> <span id="val-pe">0/0</span></div>
        <div id="soul-box" style="display:none">
            <div class="hud-line"><span class="label-ia">IA:</span> <span id="val-ia">0/0</span></div>
        </div>
    </div>

    <div id="admin">
        <div class="admin-header">Controle de Entidades & Feiticeiros</div>
        <div class="char-grid-header">
            <div>Nome</div>
            <div>Pontos de Vida</div>
            <div>Energia Amaldiçoada</div>
            <div>Integridade da Alma</div>
            <div>IA?</div>
        </div>
        <div id="mestre-lista">Carregando dados...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDF3tXgC-nNotrwula1GlvMxx_klHp3wW4",
            databaseURL: "https://rpg-jjk-89f41-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const names = ["Saito", "Fokushi", "Shigai", "Umi", "Mitsuya", "Shido"];
        const params = new URLSearchParams(window.location.search);
        const charId = params.get('char');
        const isMestre = params.get('mode') === 'admin';

        db.ref('personagens').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            
            if (charId && data[charId]) {
                const s = data[charId];
                document.getElementById('hud').style.display = 'block';
                document.getElementById('val-hp').innerText = `${s.hp}/${s.hpM}`;
                document.getElementById('val-pe').innerText = `${s.pe}/${s.peM}`;
                document.getElementById('soul-box').style.display = s.sIA ? 'block' : 'none';
                if (s.sIA) document.getElementById('val-ia').innerText = `${s.ia}/${s.hpM}`; // IA Máxima = PV Máximo
            }

            if (isMestre && document.getElementById('mestre-lista').innerHTML.includes('Carregando')) {
                document.getElementById('admin').style.display = 'block';
                let html = '';
                names.forEach(n => {
                    const d = data[n] || { hp: 10, hpM: 10, pe: 5, peM: 10, ia: 10, sIA: false };
                    html += `
                    <div class="char-row">
                        <div class="name-cell">${n}</div>
                        <div class="stat-group">
                            <input type="number" class="in-pv" id="hp-${n}" value="${d.hp}" oninput="save('${n}')">
                            <span class="separator">/</span>
                            <input type="number" class="in-pv" id="hpM-${n}" value="${d.hpM}" oninput="save('${n}')">
                        </div>
                        <div class="stat-group">
                            <input type="number" class="in-pe" id="pe-${n}" value="${d.pe}" oninput="save('${n}')">
                            <span class="separator">/</span>
                            <input type="number" class="in-pe" id="peM-${n}" value="${d.peM}" oninput="save('${n}')">
                        </div>
                        <div class="stat-group">
                            <input type="number" class="in-ia" id="ia-${n}" value="${d.ia}" oninput="save('${n}')">
                            <span class="separator">/</span>
                            <div class="max-label" id="iaM-view-${n}">${d.hpM}</div>
                        </div>
                        <div style="text-align:center"><input type="checkbox" id="sIA-${n}" ${d.sIA?'checked':''} onchange="save('${n}')"></div>
                    </div>`;
                });
                document.getElementById('mestre-lista').innerHTML = html;
            }
        });

        function save(n) {
            const hpMValue = parseInt(document.getElementById(`hpM-${n}`).value) || 0;
            const update = {
                hp: parseInt(document.getElementById(`hp-${n}`).value) || 0,
                hpM: hpMValue,
                pe: parseInt(document.getElementById(`pe-${n}`).value) || 0,
                peM: parseInt(document.getElementById(`peM-${n}`).value) || 0,
                ia: parseInt(document.getElementById(`ia-${n}`).value) || 0,
                iaM: hpMValue, // Força IA Máxima ser igual ao PV Máximo
                sIA: document.getElementById(`sIA-${n}`).checked
            };
            // Atualiza o texto visual da IA Máxima no painel
            if(document.getElementById(`iaM-view-${n}`)) document.getElementById(`iaM-view-${n}`).innerText = hpMValue;
            db.ref('personagens/' + n).update(update);
        }
    </script>
</body>
</html>
