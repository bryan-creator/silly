<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --pv: #ff4d4d; 
            --pe: #4d94ff; 
            --ia: #9933ff; 
            --gold: #d4af37;
        }
        /* Configuração para o OBS (HUD) */
        body { background: transparent; font-family: 'Courier New', Courier, monospace; color: white; margin: 0; padding: 5px; }
        
        .hud-minimal { 
            display: none; 
            filter: drop-shadow(2px 2px 3px black);
            line-height: 1.3;
        }

        .stat-line { font-size: 24px; font-weight: bold; white-space: nowrap; }
        .label-pv { color: var(--pv); }
        .label-pe { color: var(--pe); }
        .label-ia { color: var(--ia); }

        /* PAINEL DO MESTRE (CONTROLE) */
        #admin { 
            background: #111; 
            border: 3px solid var(--gold); 
            padding: 20px; 
            width: 600px; 
            display: none; 
            color: white;
            position: absolute;
            top: 10px; left: 10px;
        }
        .char-row { 
            border-bottom: 1px solid #333; 
            padding: 15px 0; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
        }
        .input-group { display: flex; align-items: center; gap: 5px; }
        input[type="number"] { 
            background: #222; 
            color: white; 
            border: 1px solid var(--gold); 
            width: 50px; 
            padding: 4px;
            font-size: 16px;
        }
        .ia-toggle { margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="hud" class="hud-minimal">
        <div class="stat-line"><span class="label-pv">PV:</span> <span id="val-hp">0/0</span></div>
        <div class="stat-line"><span class="label-pe">PE:</span> <span id="val-pe">0/0</span></div>
        <div id="soul-box" style="display:none">
            <div class="stat-line"><span class="label-ia">IA:</span> <span id="val-ia">0/0</span></div>
        </div>
    </div>

    <div id="admin">
        <h2 style="color:var(--gold); margin-top:0; border-bottom: 2px solid var(--gold);">MESTRE - CONTROLE DE ATRIBUTOS</h2>
        <div id="mestre-lista"></div>
        <p style="font-size: 12px; color: #888; margin-top: 10px;">* As mudanças são salvas e enviadas ao OBS automaticamente ao alterar os números.</p>
    </div>

    <script>
        const bc = new BroadcastChannel('jjk_sync');
        const names = ["Saito", "Fokushi", "Shigai", "Umi", "Mitsuya", "Shido"];
        const params = new URLSearchParams(window.location.search);
        const charId = params.get('char');
        const mode = params.get('mode');

        // Inicializa ou carrega os dados
        let data = JSON.parse(localStorage.getItem('rpg_save')) || {};
        names.forEach(n => { 
            if(!data[n]) data[n] = {hp:10, hpM:10, pe:5, peM:5, ia:10, iaM:10, sIA:false}; 
        });

        function draw() {
            // Se for o modo administrador (Mestre)
            if(mode === 'admin') {
                document.getElementById('admin').style.display = 'block';
                let h = '';
                names.forEach(n => {
                    const d = data[n];
                    h += `
                    <div class="char-row">
                        <b style="width: 80px;">${n}</b>
                        <div class="input-group">
                            <span class="label-pv">PV</span>
                            <input type="number" value="${d.hp}" onchange="up('${n}','hp',this.value)">/
                            <input type="number" value="${d.hpM}" onchange="up('${n}','hpM',this.value)">
                        </div>
                        <div class="input-group">
                            <span class="label-pe">PE</span>
                            <input type="number" value="${d.pe}" onchange="up('${n}','pe',this.value)">/
                            <input type="number" value="${d.peM}" onchange="up('${n}','peM',this.value)">
                        </div>
                        <div class="input-group">
                            <span class="label-ia">IA</span>
                            <input type="number" value="${d.ia}" onchange="up('${n}','ia',this.value)">/
                            <input type="number" value="${d.iaM}" onchange="up('${n}','iaM',this.value)">
                            <input type="checkbox" class="ia-toggle" ${d.sIA?'checked':''} onchange="up('${n}','sIA',this.checked)">
                        </div>
                    </div>`;
                });
                document.getElementById('mestre-lista').innerHTML = h;
            }

            // Se for o modo HUD (OBS)
            if(charId && data[charId]) {
                const s = data[charId];
                document.getElementById('hud').style.display = 'block';
                document.getElementById('val-hp').innerText = `${s.hp}/${s.hpM}`;
                document.getElementById('val-pe').innerText = `${s.pe}/${s.peM}`;
                document.getElementById('soul-box').style.display = s.sIA ? 'block' : 'none';
                if(s.sIA) document.getElementById('val-ia').innerText = `${s.ia}/${s.iaM}`;
            }
        }

        function up(n, f, v) {
            data[n][f] = (f === 'sIA') ? v : parseInt(v);
            localStorage.setItem('rpg_save', JSON.stringify(data));
            bc.postMessage(data); // Envia para o OBS
            draw();
        }

        bc.onmessage = (e) => { data = e.data; draw(); };
        draw();
    </script>
</body>
</html>
