<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --gold: #d4af37; 
            --jjk-red: #ff4d4d; 
            --blue: #4d94ff; 
            --soul: #9933ff; 
        }
        body { background: transparent; font-family: 'Courier New', Courier, monospace; color: white; margin: 0; padding: 10px; }
        
        /* HUD VISUAL (NÚMEROS APENAS) */
        .hud-card { width: 220px; display: none; filter: drop-shadow(2px 2px 5px black); }
        
        .frame { 
            width: 180px; height: 180px; 
            border: 4px solid var(--gold); 
            background: white; 
            overflow: hidden; 
        }
        .frame img { width: 100%; height: 100%; object-fit: cover; }
        
        .name-tag { 
            font-size: 20px; font-weight: bold; background: black; 
            display: inline-block; padding: 2px 10px; margin-top: -10px; 
            border: 2px solid var(--gold); position: relative; z-index: 5;
        }

        /* ÁREA DOS NÚMEROS */
        .stats-numbers { margin-top: 10px; font-weight: bold; font-size: 18px; }
        .stat-line { margin: 5px 0; display: flex; align-items: center; }
        
        .label-pv { color: var(--jjk-red); margin-right: 8px; }
        .label-pe { color: var(--blue); margin-right: 8px; }
        .label-ia { color: var(--soul); margin-right: 8px; }

        /* PAINEL MESTRE */
        #admin { background: #111; border: 2px solid var(--gold); padding: 15px; width: 450px; display: none; }
        .char-row { border-bottom: 1px solid #333; padding: 10px 0; font-size: 14px; }
        input { background: #222; color: white; border: 1px solid var(--gold); width: 45px; margin: 0 5px; }
    </style>
</head>
<body>

    <div id="hud" class="hud-card">
        <div class="frame"><img id="view-img" src=""></div>
        <div class="name-tag" id="view-name">NOME</div>
        
        <div class="stats-numbers">
            <div class="stat-line"><span class="label-pv">PV:</span> <span id="val-hp">0/0</span></div>
            <div class="stat-line"><span class="label-pe">PE:</span> <span id="val-pe">0/0</span></div>
            <div id="soul-box" style="display:none">
                <div class="stat-line"><span class="label-ia">ALMA:</span> <span id="val-ia">0/0</span></div>
            </div>
        </div>
    </div>

    <div id="admin">
        <h3 style="color:var(--gold); margin-top:0;">MESTRE - CONTROLE DE STATUS</h3>
        <div id="mestre-lista"></div>
    </div>

    <script>
        const bc = new BroadcastChannel('jjk_sync');
        const names = ["Saito", "Fokushi", "Shigai", "Umi", "Mitsuya", "Shido"];
        const params = new URLSearchParams(window.location.search);
        const charId = params.get('char');
        const mode = params.get('mode');

        let data = JSON.parse(localStorage.getItem('rpg_save')) || {};
        names.forEach(n => { if(!data[n]) data[n] = {hp:10, hpM:10, pe:5, peM:5, ia:10, iaM:10, sIA:false, img:''}; });

        function draw() {
            if(mode === 'admin') {
                document.getElementById('admin').style.display = 'block';
                let h = '';
                names.forEach(n => {
                    const d = data[n];
                    h += `<div class="char-row">
                        <b>${n}</b> | PV: <input type="number" value="${d.hp}" onchange="up('${n}','hp',this.value)">/
                        <input type="number" value="${d.hpM}" onchange="up('${n}','hpM',this.value)"> | 
                        PE: <input type="number" value="${d.pe}" onchange="up('${n}','pe',this.value)"> | 
                        ALMA: <input type="checkbox" ${d.sIA?'checked':''} onchange="up('${n}','sIA',this.checked)"> | 
                        IMG: <input type="text" style="width:80px" value="${d.img}" onchange="up('${n}','img',this.value)">
                    </div>`;
                });
                document.getElementById('mestre-lista').innerHTML = h;
            }

            if(charId && data[charId]) {
                const s = data[charId];
                document.getElementById('hud').style.display = 'block';
                document.getElementById('view-name').innerText = charId;
                document.getElementById('view-img').src = s.img || 'https://via.placeholder.com/180?text=FOTO';
                document.getElementById('val-hp').innerText = `${s.hp}/${s.hpM}`;
                document.getElementById('val-pe').innerText = `${s.pe}/${s.peM}`;
                document.getElementById('soul-box').style.display = s.sIA ? 'block' : 'none';
                if(s.sIA) document.getElementById('val-ia').innerText = `${s.ia}/${s.iaM}`;
            }
        }

        function up(n, f, v) {
            data[n][f] = (f === 'sIA') ? v : (f === 'img' ? v : parseInt(v));
            localStorage.setItem('rpg_save', JSON.stringify(data));
            bc.postMessage(data);
            draw();
        }

        bc.onmessage = (e) => { data = e.data; draw(); };
        draw();
    </script>
</body>
</html>
